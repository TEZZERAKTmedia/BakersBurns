import{r,j as e,m as I,A as H,a as C,u as U}from"./index-BQfN0DYW.js";import{L as G}from"./loading-DMS03M9D.js";const Y=({receiverZip:n,onSelectRate:x,totalWeight:d,totalDimensions:m,isOpen:u,onToggle:l})=>{const[S,g]=r.useState(!1),[c,v]=r.useState([]),[i,h]=r.useState(!1),[p,P]=r.useState(null),$="81502",f=typeof u=="boolean",N=f?u:S,b=async()=>{h(!0);try{const a=await C.post("/register-rates/ups-rates",{shipperZip:$,receiverZip:n,weight:d,dimensions:{length:m.length,width:m.width,height:m.height}});v(a.data.ups||[])}catch(a){console.error("❌ Error fetching UPS rates:",a)}finally{h(!1)}},D=a=>{P(a.serviceName),x(a.serviceName,a.cost)},F=()=>{f?(l&&l(),u||b()):g(a=>{const j=!a;return j&&b(),j})};return e.jsxs("div",{className:"form-section",children:[e.jsx(I.button,{onClick:F,whileHover:{scale:1.05},whileTap:{scale:.95},className:"ups-button",children:"UPS Rates"}),N&&e.jsx("div",{className:"rate-dropdown",children:i?e.jsx(G,{}):c.length?e.jsx(H,{children:c.map((a,j)=>e.jsxs(I.button,{onClick:()=>D(a),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},whileHover:{scale:1.02},whileTap:{scale:.98},className:`rate-option ${p===a.serviceName?"selected":""}`,style:{position:"relative",overflow:"hidden",width:"100%",padding:"8px",border:"none",background:"transparent"},children:[e.jsx(I.div,{initial:{width:"0%"},animate:{width:p===a.serviceName?"100%":"0%"},transition:{duration:.4},className:"absolute top-0 left-0 h-full bg-blue-600 opacity-20"}),e.jsxs("div",{className:"rate-option-content",style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",position:"relative",zIndex:1},children:[e.jsxs("div",{className:"rate-price",style:{fontWeight:"bold",fontSize:"1.2em"},children:["$",a.cost?a.cost.toFixed(2):"N/A"]}),e.jsxs("div",{className:"rate-details",style:{textAlign:"right",lineHeight:1.2},children:[e.jsx("div",{className:"rate-name",style:{fontSize:"1em",marginBottom:"4px"},children:a.serviceName}),e.jsx("div",{className:"rate-delivery",style:{fontSize:"0.9em",color:"#555"},children:a.estimatedDeliveryDate&&a.estimatedDeliveryDate!=="N/A"?`Est. Delivery: ${a.estimatedDeliveryDate} (${a.approxDays||"3-5 days"})`:"Est. Delivery Not Available"})]})]})]},j))}):e.jsx(I.p,{className:"no-rates",initial:{opacity:0},animate:{opacity:1},children:"No UPS rates available"})})]})},_="/assets/trash-BZNBF-0h.webp",J=({cart:n,receiverZip:x,shippingCost:d,taxAmount:m,grandTotal:u,selectedCarrier:l,selectedService:S,onClose:g})=>{const c=U(),v=async()=>{console.log("✅ Confirm Checkout Clicked!");const i={selectedCarrier:l,selectedService:S,shippingCost:d};try{const h=localStorage.getItem("sessionId");if(!h)throw new Error("Session ID not found.");await C.post("/register-cart/update-shipping",{sessionId:h,shippingDetails:i}),console.log("🚀 Shipping details stored in the database."),c("/checkout-options")}catch(h){console.error("Error saving shipping details:",h),alert("There was an error saving your shipping details. Please try again.")}};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-details",children:[e.jsx("h3",{children:"Items in Cart"}),e.jsx("ul",{children:n.map(i=>e.jsxs("li",{children:[i.quantity,"x ",i.name," - $",i.price.toFixed(2)]},i.id))}),e.jsx("h3",{children:"Shipping Method"}),e.jsx("p",{children:l?`${l} - ${S}`:"Not Selected"}),e.jsx("h3",{children:"Shipping Cost"}),e.jsxs("p",{children:["$",d?d.toFixed(2):"Not Selected"]}),e.jsx("h3",{children:"Tax"}),e.jsxs("p",{children:["$",m.toFixed(2)]}),e.jsx("h3",{children:"Grand Total"}),e.jsx("p",{children:e.jsxs("strong",{children:["$",u.toFixed(2)]})})]}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:v,className:"proceed-checkout",children:"Confirm & Proceed"}),e.jsx("button",{onClick:g,className:"cancel-button",children:"Cancel"})]})]})})},K=n=>!n||n.length<1?0:n.startsWith("9")?.0725:n.startsWith("1")?.08875:.06,ee=()=>{const[n,x]=r.useState([]),[d,m]=r.useState(0),[u,l]=r.useState(null),[S,g]=r.useState(!1),[c,v]=r.useState(""),[i,h]=r.useState(null),[p,P]=r.useState(!1),[$,f]=r.useState(!1),[N,b]=r.useState(null),[D,F]=r.useState(null),[a,j]=r.useState(null),T=U(),w=(()=>{let t=localStorage.getItem("sessionId");return t||(t=`guest_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("sessionId",t)),t})(),Z=p?K(c):0,k=i?(d+i)*Z:0,q=i?d+i+k:d,A=()=>{if(!i||!N){alert("Please select a shipping option before proceeding.");return}f(!0)},M=()=>{const t={shippingCost:i,selectedCarrier:N,receiverZip:c,taxAmount:k,grandTotal:q};Cookies.set("shippingDetails",JSON.stringify(t),{expires:1}),T("/checkout-options")};r.useEffect(()=>{(async()=>{g(!0);try{const o=(await C.post("/register-cart/items",{sessionId:w})).data.cartDetails||[];x(o),E(o)}catch(s){console.error("❌ Error fetching cart items:",s),l("Error loading cart items.")}finally{g(!1)}})()},[w]);const E=t=>{const s=t.reduce((o,y)=>o+y.price*y.quantity,0);m(s)},z=n.reduce((t,s)=>t+s.weight*s.quantity,0),L=n.reduce((t,s)=>({length:t.length+s.length*s.quantity,width:Math.max(t.width,s.width),height:Math.max(t.height,s.height)}),{length:0,width:0,height:0}),R=async(t,s)=>{try{const o=n.map(y=>y.id===t?{...y,quantity:Math.max(1,s)}:y);x(o),E(o),await C.post("/register-cart/add-guest-cart",{sessionId:w,productId:t,quantity:s})}catch(o){console.error("Error updating quantity:",o),l("Failed to update quantity.")}},O=async t=>{try{await C.post("/register-cart/delete-cart-item",{sessionId:w,productId:t,quantity:0});const s=n.filter(o=>o.id!==t);x(s),E(s)}catch(s){console.error("Error deleting item:",s),l("Failed to remove item.")}},B=()=>{c.length===5&&/^\d+$/.test(c)?P(!0):alert("Please enter a valid 5-digit ZIP code.")};if(n.length===0)return e.jsxs("div",{className:"cart-container empty",children:[e.jsx("h2",{children:"Your cart is empty!"}),e.jsx("button",{onClick:()=>T("/store"),className:"cart-back-button",children:"Back to Store"})]});const W=(t,s,o)=>{b(t),F(s),h(o)};return e.jsx("div",{className:"cart-container",children:e.jsxs("div",{className:"cart-section",children:[e.jsx("h2",{className:"cart-title",children:"Your Cart"}),u&&e.jsx("p",{className:"cart-error",children:u}),e.jsx("div",{className:"cart-items",children:n.map(t=>e.jsxs("div",{className:"cart-item",children:[e.jsxs("div",{className:"cart-item-info",children:[e.jsx("img",{src:`https://api.bakersburns.com/uploads/${t.thumbnail}`,alt:t.name,className:"cart-item-image"}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("h4",{className:"cart-item-name",children:t.name}),e.jsxs("p",{className:"cart-item-price",children:["$",t.price.toFixed(2)]})]}),e.jsx("img",{src:_,alt:"Delete",className:"delete-icon",onClick:()=>O(t.id)})]}),e.jsxs("div",{className:"cart-item-quantity-control",children:[e.jsx("button",{className:"quantity-button",onClick:()=>R(t.id,t.quantity-1),children:"-"}),e.jsx("input",{type:"number",value:t.quantity,onChange:s=>R(t.id,parseInt(s.target.value,10))}),e.jsx("button",{className:"quantity-button",onClick:()=>R(t.id,t.quantity+1),children:"+"})]})]},t.id))}),e.jsxs("div",{className:"shipping-section",children:[e.jsx("label",{htmlFor:"zip",children:"Enter ZIP Code:"}),e.jsx("input",{type:"text",id:"zip",value:c,onChange:t=>v(t.target.value),placeholder:"Enter your ZIP code",disabled:p}),e.jsx("button",{className:"zip-button",onClick:B,disabled:p,children:p?"ZIP Code Submitted":"Submit ZIP Code"})]}),p&&e.jsx("div",{className:"carrier-buttons",children:e.jsx(Y,{receiverZip:c,totalWeight:z,totalDimensions:L,onSelectRate:(t,s)=>W("UPS",t,s),isOpen:a==="UPS",onToggle:()=>j(a==="UPS"?null:"UPS")})}),e.jsxs("div",{className:"shipping-summary",children:[e.jsxs("h3",{children:["Shipping Cost: ",i?`$${i.toFixed(2)}`:"Not Selected"]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("h4",{children:["Tax (",(Z*100).toFixed(2),"%): $",k.toFixed(2)]}),e.jsxs("h3",{children:["Grand Total: $",q.toFixed(2)]})]})]}),e.jsx("button",{onClick:A,className:`proceed-checkout ${i?"":"disabled"}`,children:"Proceed to Checkout"}),$&&e.jsx(J,{cart:n,shippingCost:i,taxAmount:k,grandTotal:q,selectedCarrier:N,selectedService:D,receiverZip:c,onClose:()=>f(!1),onConfirm:M})]})})};export{ee as default};
