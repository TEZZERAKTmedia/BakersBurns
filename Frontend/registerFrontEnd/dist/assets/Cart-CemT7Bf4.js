import{r as o,j as e,m as f,A as z,a as C,u as L}from"./index-BzGw-Pq-.js";import{L as M}from"./loading-BtWdGu1F.js";const J=({receiverZip:r,onSelectRate:g,totalWeight:d,totalDimensions:h,isOpen:c,onToggle:l})=>{const[y,S]=o.useState(!1),[i,j]=o.useState([]),[n,x]=o.useState(!1),[m,P]=o.useState(null),k="81502",v=typeof c=="boolean",N=v?c:y,b=async()=>{x(!0);try{const t=await C.post("/register-rates/ups-rates",{shipperZip:k,receiverZip:r,weight:d,dimensions:{length:h.length,width:h.width,height:h.height}});j(t.data.ups||[])}catch(t){console.error("âŒ Error fetching UPS rates:",t)}finally{x(!1)}},R=t=>{P(t.serviceName),g(t.serviceName,t.cost)},E=()=>{v?(l&&l(),c||b()):S(t=>{const p=!t;return p&&b(),p})};return e.jsxs("div",{className:"form-section",children:[e.jsx(f.button,{onClick:E,whileHover:{scale:1.05},whileTap:{scale:.95},className:"ups-button",children:"UPS Rates"}),N&&e.jsx("div",{className:"rate-dropdown",children:n?e.jsx(M,{}):i.length?e.jsx(z,{children:i.map((t,p)=>e.jsxs(f.button,{onClick:()=>R(t),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},whileHover:{scale:1.02},whileTap:{scale:.98},className:`rate-option ${m===t.serviceName?"selected":""}`,style:{position:"relative",overflow:"hidden",width:"100%",padding:"8px",border:"none",background:"transparent"},children:[e.jsx(f.div,{initial:{width:"0%"},animate:{width:m===t.serviceName?"100%":"0%"},transition:{duration:.4},className:"absolute top-0 left-0 h-full bg-blue-600 opacity-20"}),e.jsxs("div",{className:"rate-option-content",style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",position:"relative",zIndex:1},children:[e.jsxs("div",{className:"rate-price",style:{fontWeight:"bold",fontSize:"1.2em"},children:["$",t.cost?t.cost.toFixed(2):"N/A"]}),e.jsxs("div",{className:"rate-details",style:{textAlign:"right",lineHeight:1.2},children:[e.jsx("div",{className:"rate-name",style:{fontSize:"1em",marginBottom:"4px"},children:t.serviceName}),e.jsx("div",{className:"rate-delivery",style:{fontSize:"0.9em",color:"#555"},children:t.estimatedDeliveryDate&&t.estimatedDeliveryDate!=="N/A"?`Est. Delivery: ${t.estimatedDeliveryDate} (${t.approxDays||"3-5 days"})`:"Est. Delivery Not Available"})]})]})]},p))}):e.jsx(f.p,{className:"no-rates",initial:{opacity:0},animate:{opacity:1},children:"No UPS rates available"})})]})},Y=({receiverZip:r,onSelectRate:g})=>{const[d,h]=o.useState([]),[c,l]=o.useState(!1),y=async()=>{try{const i=await C.post("/register-rates/fedex-rates",{receiverZip:r});h(i.data.fedex||[])}catch(i){console.error("Error fetching FedEx rates:",i)}},S=()=>{c||y(),l(!c)};return e.jsxs("div",{className:"carrier-rate",children:[e.jsx("button",{onClick:S,children:"FedEx Rates"}),c&&e.jsx("div",{className:"rate-dropdown",children:d.length?d.map((i,j)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"shippingOption",value:i.cost,onChange:()=>g(i.cost)}),i.serviceName," - $",i.cost.toFixed(2)]},j)):e.jsx("p",{children:"No FedEx rates available"})})]})},_=({receiverZip:r,onSelectRate:g,totalWeight:d,totalDimensions:h,isOpen:c,onToggle:l})=>{const[y,S]=o.useState(!1),[i,j]=o.useState([]),[n,x]=o.useState(!1),[m,P]=o.useState(null),k="81502",v=typeof c=="boolean",N=v?c:y,b=async()=>{x(!0);try{const t=await C.post("/register-rates/usps-rates",{shipperZip:k,receiverZip:r,weight:d,dimensions:{length:h.length,width:h.width,height:h.height}});console.log("ðŸ“¡ USPS Rates Response:",JSON.stringify(t.data,null,2)),j(t.data.usps||[])}catch(t){console.error("âŒ Error fetching USPS rates:",t)}finally{x(!1)}},R=()=>{v?(l&&l(),c||b()):S(t=>{const p=!t;return p&&b(),p})},E=t=>{P(t.serviceCode),g(t.cost)};return e.jsxs("div",{className:"form-section",children:[e.jsx(f.button,{onClick:R,whileHover:{scale:1.05},whileTap:{scale:.95},className:"usps-button",children:"USPS Rates"}),N&&e.jsx("div",{className:"usps-rate-dropdown",children:n?e.jsx(M,{}):i.length?e.jsx(z,{children:i.map((t,p)=>e.jsxs(f.button,{onClick:()=>E(t),initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},whileHover:{scale:1.02},whileTap:{scale:.98},className:`usps-rate-option ${m===t.serviceCode?"selected":""}`,style:{position:"relative",overflow:"hidden",width:"100%",padding:"8px",border:"none",background:"transparent"},children:[e.jsx(f.div,{initial:{width:"0%"},animate:{width:m===t.serviceCode?"100%":"0%"},transition:{duration:.4},className:"absolute top-0 left-0 h-full bg-red-600 opacity-20"}),e.jsxs("div",{className:"usps-rate-option-content",style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",position:"relative",zIndex:1},children:[e.jsxs("div",{className:"usps-rate-price",style:{fontWeight:"bold",fontSize:"1.2em"},children:["$",t.cost?t.cost.toFixed(2):"N/A"]}),e.jsxs("div",{className:"usps-rate-details",style:{textAlign:"right",lineHeight:1.2},children:[e.jsx("div",{className:"usps-rate-name",style:{fontSize:"1em",marginBottom:"4px"},children:t.serviceName}),e.jsx("div",{className:"usps-rate-delivery",style:{fontSize:"0.9em",color:"#555"},children:t.estimatedDeliveryDate&&t.estimatedDeliveryDate!=="N/A"?`Est. Delivery: ${t.estimatedDeliveryDate} (${t.approxDays||"3-5 days"})`:"Est. Delivery Not Available"})]})]})]},p))}):e.jsx(f.p,{className:"usps-no-rates",initial:{opacity:0},animate:{opacity:1},children:"No USPS rates available"})})]})},K="/assets/trash-BZNBF-0h.webp",Q=({cart:r,receiverZip:g,shippingCost:d,taxAmount:h,grandTotal:c,selectedCarrier:l,selectedService:y,onClose:S})=>{const i=L(),j=async()=>{console.log("âœ… Confirm Checkout Clicked!");const n={selectedCarrier:l,selectedService:y,shippingCost:d};try{const x=localStorage.getItem("sessionId");if(!x)throw new Error("Session ID not found.");await C.post("/register-cart/update-shipping",{sessionId:x,shippingDetails:n}),console.log("ðŸš€ Shipping details stored in the database."),i("/checkout-options")}catch(x){console.error("Error saving shipping details:",x),alert("There was an error saving your shipping details. Please try again.")}};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h2",{children:"Order Summary"}),e.jsxs("div",{className:"summary-details",children:[e.jsx("h3",{children:"Items in Cart"}),e.jsx("ul",{children:r.map(n=>e.jsxs("li",{children:[n.quantity,"x ",n.name," - $",n.price.toFixed(2)]},n.id))}),e.jsx("h3",{children:"Shipping Method"}),e.jsx("p",{children:l?`${l} - ${y}`:"Not Selected"}),e.jsx("h3",{children:"Shipping Cost"}),e.jsxs("p",{children:["$",d?d.toFixed(2):"Not Selected"]}),e.jsx("h3",{children:"Tax"}),e.jsxs("p",{children:["$",h.toFixed(2)]}),e.jsx("h3",{children:"Grand Total"}),e.jsx("p",{children:e.jsxs("strong",{children:["$",c.toFixed(2)]})})]}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{onClick:j,className:"proceed-checkout",children:"Confirm & Proceed"}),e.jsx("button",{onClick:S,className:"cancel-button",children:"Cancel"})]})]})})},V=r=>!r||r.length<1?0:r.startsWith("9")?.0725:r.startsWith("1")?.08875:.06,se=()=>{const[r,g]=o.useState([]),[d,h]=o.useState(0),[c,l]=o.useState(null),[y,S]=o.useState(!1),[i,j]=o.useState(""),[n,x]=o.useState(null),[m,P]=o.useState(!1),[k,v]=o.useState(!1),[N,b]=o.useState(null),[R,E]=o.useState(null),[t,p]=o.useState(null),A=L(),F=(()=>{let s=localStorage.getItem("sessionId");return s||(s=`guest_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("sessionId",s)),s})(),O=m?V(i):0,I=n?(d+n)*O:0,$=n?d+n+I:d,H=()=>{if(!n||!N){alert("Please select a shipping option before proceeding.");return}v(!0)},B=()=>{const s={shippingCost:n,selectedCarrier:N,receiverZip:i,taxAmount:I,grandTotal:$};Cookies.set("shippingDetails",JSON.stringify(s),{expires:1}),A("/checkout-options")};o.useEffect(()=>{(async()=>{S(!0);try{const u=(await C.post("/register-cart/items",{sessionId:F})).data.cartDetails||[];g(u),D(u)}catch(a){console.error("âŒ Error fetching cart items:",a),l("Error loading cart items.")}finally{S(!1)}})()},[F]);const D=s=>{const a=s.reduce((u,w)=>u+w.price*w.quantity,0);h(a)},U=r.reduce((s,a)=>s+a.weight*a.quantity,0),T=r.reduce((s,a)=>({length:s.length+a.length*a.quantity,width:Math.max(s.width,a.width),height:Math.max(s.height,a.height)}),{length:0,width:0,height:0}),q=async(s,a)=>{try{const u=r.map(w=>w.id===s?{...w,quantity:Math.max(1,a)}:w);g(u),D(u),await C.post("/register-cart/add-guest-cart",{sessionId:F,productId:s,quantity:a})}catch(u){console.error("Error updating quantity:",u),l("Failed to update quantity.")}},W=async s=>{try{await C.post("/register-cart/delete-cart-item",{sessionId:F,productId:s,quantity:0});const a=r.filter(u=>u.id!==s);g(a),D(a)}catch(a){console.error("Error deleting item:",a),l("Failed to remove item.")}},G=()=>{i.length===5&&/^\d+$/.test(i)?P(!0):alert("Please enter a valid 5-digit ZIP code.")};if(r.length===0)return e.jsxs("div",{className:"cart-container empty",children:[e.jsx("h2",{children:"Your cart is empty!"}),e.jsx("button",{onClick:()=>A("/store"),className:"cart-back-button",children:"Back to Store"})]});const Z=(s,a,u)=>{b(s),E(a),x(u)};return e.jsx("div",{className:"cart-container",children:e.jsxs("div",{className:"cart-section",children:[e.jsx("h2",{className:"cart-title",children:"Your Cart"}),c&&e.jsx("p",{className:"cart-error",children:c}),e.jsx("div",{className:"cart-items",children:r.map(s=>e.jsxs("div",{className:"cart-item",children:[e.jsxs("div",{className:"cart-item-info",children:[e.jsx("img",{src:`https://api.bakersburns.com/uploads/${s.thumbnail}`,alt:s.name,className:"cart-item-image"}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("h4",{className:"cart-item-name",children:s.name}),e.jsxs("p",{className:"cart-item-price",children:["$",s.price.toFixed(2)]})]}),e.jsx("img",{src:K,style:{height:"3vh",width:"auto",marginLeft:"50%"},alt:"Delete",className:"delete-icon",onClick:()=>W(s.id)})]}),e.jsxs("div",{className:"cart-item-quantity-control",children:[e.jsx("button",{className:"quantity-button",onClick:()=>q(s.id,s.quantity-1),children:"-"}),e.jsx("input",{type:"number",value:s.quantity,onChange:a=>q(s.id,parseInt(a.target.value,10))}),e.jsx("button",{className:"quantity-button",onClick:()=>q(s.id,s.quantity+1),children:"+"})]})]},s.id))}),e.jsxs("div",{className:"shipping-section",children:[e.jsx("label",{htmlFor:"zip",children:"Enter ZIP Code:"}),e.jsx("input",{type:"text",id:"zip",value:i,onChange:s=>j(s.target.value),placeholder:"Enter your ZIP code",disabled:m}),e.jsx("button",{className:"quantity-button",onClick:G,disabled:m,children:m?"ZIP Code Submitted":"Submit ZIP Code"})]}),m&&e.jsxs("div",{className:"carrier-buttons",children:[e.jsx(J,{receiverZip:i,totalWeight:U,totalDimensions:T,onSelectRate:(s,a)=>Z("UPS",s,a),isOpen:t==="UPS",onToggle:()=>p(t==="UPS"?null:"UPS")}),e.jsx(Y,{receiverZip:i,totalWeight:U,totalDimensions:T,onSelectRate:(s,a)=>Z("FedEx",s,a),isOpen:t==="FedEx",onToggle:()=>p(t==="FedEx"?null:"FedEx")}),e.jsx(_,{receiverZip:i,totalWeight:U,totalDimensions:T,onSelectRate:(s,a)=>Z("USPS",s,a),isOpen:t==="USPS",onToggle:()=>p(t==="USPS"?null:"USPS")})]}),e.jsxs("div",{className:"shipping-summary",children:[e.jsxs("h3",{children:["Shipping Cost: ",n?`$${n.toFixed(2)}`:"Not Selected"]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("h4",{children:["Tax (",(O*100).toFixed(2),"%): $",I.toFixed(2)]}),e.jsxs("h3",{children:["Grand Total: $",$.toFixed(2)]})]})]}),e.jsx("button",{onClick:H,className:`proceed-checkout ${n?"":"disabled"}`,children:"Proceed to Checkout"}),k&&e.jsx(Q,{cart:r,shippingCost:n,taxAmount:I,grandTotal:$,selectedCarrier:N,selectedService:R,receiverZip:i,onClose:()=>v(!1),onConfirm:B})]})})};export{se as default};
